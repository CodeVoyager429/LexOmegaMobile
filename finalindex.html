<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>LexOmega ‚Äî The First AI Law Firm</title>

  <!-- Set to your backend (e.g., https://lexomega-executor.vercel.app).
       You can also override via ?backend=https://‚Ä¶ in the URL. -->
  <meta name="lex-backend" content="">

  <meta name="theme-color" content="#0ea5b1" />
  <style>
    :root{
      --bg:#0b0b0c; --panel:#121315; --muted:#cbd5e1; --text:#e5e7eb;
      --brand:#14b8a6; --brand-2:#06b6d4; --accent:#facc15; --line:#f2c200;
      --shadow:0 10px 30px rgba(0,0,0,.35)
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font:16px/1.55 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial;
      color:var(--text); background:var(--bg)
    }
    a{color:#7dd3fc; text-decoration:none} a:hover{text-decoration:underline}
    .wrap{max-width:1100px; margin:0 auto; padding:18px}
    header{
      position:sticky; top:0; z-index:50; background:rgba(11,11,12,.92);
      border-bottom:2px solid var(--line); backdrop-filter:saturate(140%) blur(6px)
    }
    .nav{display:flex; align-items:center; justify-content:space-between; gap:12px}
    .brand{display:flex; align-items:center; gap:12px}
    .badge{background:#0ea5b1; color:#001014; font-weight:700; padding:6px 10px; border-radius:999px}
    .menu{display:flex; flex-wrap:wrap; gap:18px}
    .menu a{padding:8px 2px; border-bottom:2px solid transparent}
    .menu a:hover,.menu a.active{border-color:var(--line)}
    .btn{
      appearance:none; border:0; border-radius:14px; padding:12px 18px; font-weight:700;
      background:var(--accent); color:#14120a; box-shadow:var(--shadow); cursor:pointer
    }
    .btn.secondary{background:#0ea5b1; color:#081a1a}
    .btn.ghost{background:#1f2937; color:#e5e7eb}
    .hero{padding:28px 0 18px}
    h1{font-size:40px; margin:12px 0 6px; color:#67e8f9}
    h2{font-size:28px; margin:26px 0 14px}
    p.lede{color:#b6c2d1; font-size:18px}
    .row{display:grid; grid-template-columns:1fr; gap:24px}
    .card{
      background:var(--panel); border:1px solid #22252a; border-radius:18px; padding:18px; box-shadow:var(--shadow)
    }
    .grid-2{display:grid; grid-template-columns:1fr; gap:18px}
    @media(min-width:880px){ .grid-2{grid-template-columns:1.2fr .8fr} .row{grid-template-columns:1fr 1fr}}
    .docPreview{background:#0f1114; border:1px solid #1e2630; border-radius:16px; overflow:hidden}
    .docBar{display:flex; gap:22px; padding:10px 14px; border-bottom:2px solid var(--line); background:#0c0e11}
    .docPane{padding:20px}
    .ribbon{margin:10px 0 0; background:#0e9fad; color:#021416; padding:8px 12px; border-radius:10px; font-weight:700}
    .footer{border-top:2px solid var(--line); margin-top:36px; padding:18px 0 120px; color:#cbd5e1}
    .floatChat{
      position:fixed; right:18px; bottom:18px; z-index:60;
      display:flex; align-items:center; gap:8px; padding:12px 16px; border-radius:999px;
      background:var(--accent); color:#111; box-shadow:var(--shadow); cursor:pointer
    }
    .toast{
      position:fixed; left:50%; transform:translateX(-50%);
      bottom:92px; background:#111827; color:#e5e7eb; padding:10px 14px;
      border:1px solid #263041; border-radius:10px; display:none; z-index:70
    }
    dialog{
      width:min(860px,95vw); border:1px solid #2a3342; border-radius:14px; padding:0; background:#0f1216; color:#e5e7eb;
      box-shadow:var(--shadow)
    }
    dialog::backdrop{background:rgba(0,0,0,.6)}
    .chatHdr{display:flex; align-items:center; justify-content:space-between; padding:12px 16px; border-bottom:1px solid #222b39}
    .chatBody{display:grid; grid-template-rows:1fr auto; height:70vh}
    .msgs{padding:14px; overflow:auto}
    .msg{padding:10px 12px; border-radius:12px; margin:8px 0; max-width:80%}
    .me{background:#0ea5b1; color:#052427; margin-left:auto}
    .bot{background:#1f2937}
    .composer{display:flex; gap:8px; padding:12px; border-top:1px solid #222b39}
    .composer input{flex:1; border:1px solid #2a3342; border-radius:12px; padding:12px; background:#0b0e12; color:#e5e7eb}
    .mic{border-radius:12px; padding:0 12px}
    .kbd{font:12px/1.6 ui-monospace,SFMono-Regular,Menlo,monospace; color:#cbd5e1; opacity:.8}
  </style>
</head>
<body>
  <header>
    <div class="wrap nav">
      <div class="brand">
        <span class="badge">LexOmega</span>
        <span class="kbd">Launch Offer: 30-day free trial</span>
      </div>
      <nav class="menu">
        <a href="#home" class="active">Home</a>
        <a href="#dashboard">Dashboard</a>
        <a href="#tools">Tools</a>
        <a href="#documents">Documents</a>
        <a href="#notary">Notary</a>
        <a href="#secretary">Secretary</a>
        <a href="#case-builder">Case Builder</a>
        <a href="#billing">Billing</a>
      </nav>
      <div class="menu">
        <button class="btn ghost" id="btn-login">Login</button>
        <button class="btn secondary" id="btn-register">Create Account</button>
        <button class="btn" id="btn-subscribe">Subscribe</button>
      </div>
    </div>
  </header>

  <main class="wrap">
    <section class="hero grid-2" id="home">
      <div class="card">
        <h1>Welcome to LexOmega</h1>
        <p class="lede">The Future of Legal Intelligence ‚Äî analytics, case tracking, document generation, and real-time alerts.</p>
        <div style="display:flex; gap:12px; margin-top:12px; flex-wrap:wrap">
          <button class="btn ghost" id="btn-login-2">Login</button>
          <button class="btn secondary" id="btn-register-2">Create Account</button>
          <button class="btn" id="btn-subscribe-2">Subscribe</button>
          <button class="btn ghost" id="btn-portal">Manage Billing</button>
        </div>
        <div class="ribbon">Tip: Click ‚ÄúChat‚Äù (bottom-right) to Ask-Lex with voice.</div>
      </div>
      <div class="card">
        <h2>Live Dashboard Preview</h2>
        <p>Shows usage, recent documents, and alerts once you‚Äôre signed in.</p>
        <div class="docPreview" aria-label="preview">
          <div class="docBar"><strong>LexOmega ‚Äî The First AI Law Firm</strong></div>
          <div class="docPane">
            <p style="margin:0 0 8px">Home ‚Ä¢ Dashboard ‚Ä¢ Tools ‚Ä¢ Documents</p>
            <p class="lede">Your workspace at a glance. AI summaries and quick actions appear here.</p>
          </div>
        </div>
      </div>
    </section>

    <section class="row" id="documents">
      <div class="card">
        <h2>Embedded Legal Document Preview</h2>
        <p><a href="#" id="sampleDocLink">LexOmega ‚Äî Document Sample</a></p>
        <p>This is a preview of a legal document.</p>
      </div>
      <div class="card" id="billing">
        <h2>Billing</h2>
        <p>Start your subscription or manage your existing plan.</p>
        <div style="display:flex; gap:12px; flex-wrap:wrap">
          <button class="btn" id="btn-subscribe-3">Subscribe</button>
          <button class="btn ghost" id="btn-portal-2">Manage Billing</button>
        </div>
      </div>
    </section>

    <section class="footer">
      <div id="dailyVerse" style="text-align:center; font-size:15px; margin-bottom:8px">Loading daily verse‚Ä¶</div>
      <div style="text-align:center; opacity:.85">¬© 2025 LexOmega. All rights reserved.</div>
    </section>
  </main>

  <!-- Floating Chat -->
  <button class="floatChat" id="openChat"><span>üí¨</span> <strong>Chat</strong></button>
  <div class="toast" id="toast"></div>

  <dialog id="chatDlg">
    <div class="chatHdr">
      <strong>Ask-Lex</strong>
      <button class="btn ghost" id="closeChat">Close</button>
    </div>
    <div class="chatBody">
      <div class="msgs" id="msgs" aria-live="polite"></div>
      <div class="composer">
        <input id="chatInput" placeholder="Ask Lex anything‚Ä¶" />
        <button class="btn mic" id="micBtn" title="Voice input">üéôÔ∏è</button>
        <button class="btn secondary" id="sendBtn">Send</button>
      </div>
    </div>
  </dialog>

<script>
(function(){
  // ---------- Backend origin resolution (query param > meta > same-origin) ----------
  const params = new URLSearchParams(location.search);
  const qpBackend = params.get('backend')?.trim() || "";
  const meta = document.querySelector('meta[name="lex-backend"]');
  const metaBackend = (meta && meta.content.trim()) || "";
  const BACKEND = qpBackend || metaBackend || ""; // empty => same-origin
  const API = (path) => (BACKEND ? BACKEND : "") + path;

  // ---------- Small helpers ----------
  const $ = (sel) => document.querySelector(sel);
  const toast = (msg, ms=2800) => {
    const t = $('#toast'); t.textContent = msg; t.style.display='block';
    clearTimeout(toast._t); toast._t=setTimeout(()=>t.style.display='none', ms);
  };
  function readCookie(name){
    return document.cookie.split(';').map(s=>s.trim()).find(s=>s.startsWith(name+'='))?.split('=')[1] || '';
  }
  function csrf(){
    // Accept several names to align with whatever backend sets
    const c = readCookie('lo_csrf') || readCookie('csrf') || readCookie('XSRF-TOKEN');
    return decodeURIComponent(c || '');
  }
  async function fetchJSON(url, opts={}){
    const init = Object.assign({ credentials:'include', headers: { 'Content-Type':'application/json' }}, opts);
    if (opts && opts.method && opts.method !== 'GET'){
      init.headers['X-CSRF-Token'] = csrf();
    }
    const r = await fetch(url, init);
    const text = await r.text();
    let j; try { j = JSON.parse(text); } catch { j = { ok:r.ok, raw:text }; }
    if(!r.ok || j.ok === false){ throw new Error(j.error || ('HTTP '+r.status)); }
    return j;
  }

  // ---------- CSRF priming: GET /api/health to set cookie ----------
  (async () => {
    try { await fetchJSON(API('/api/health'), { method:'GET' }); }
    catch { /* fine: some backends may not expose health publicly */ }
  })();

  // ---------- Auth placeholders (wire to your existing /api/auth/* if needed) ----------
  const goLogin = () => toast('Login: /api/auth/login (UI stub)');
  $('#btn-login')?.addEventListener('click', goLogin);
  $('#btn-login-2')?.addEventListener('click', goLogin);
  $('#btn-register')?.addEventListener('click', ()=>toast('Register: /api/auth/register (UI stub)'));
  $('#btn-register-2')?.addEventListener('click', ()=>toast('Register: /api/auth/register (UI stub)'));

  // ---------- Billing ----------
  async function startCheckout(){
    try {
      const j = await fetchJSON(API('/api/billing/checkout'), { method:'POST', body: JSON.stringify({}) });
      if (j.url) location.href = j.url; else toast('No checkout URL returned');
    } catch(e){ toast('Checkout error: '+e.message); }
  }
  async function openPortal(){
    try {
      const j = await fetchJSON(API('/api/billing/portal'), { method:'POST', body: JSON.stringify({}) });
      if (j.url) location.href = j.url; else toast('No portal URL returned');
    } catch(e){ toast('Portal error: '+e.message); }
  }
  ['#btn-subscribe','#btn-subscribe-2','#btn-subscribe-3'].forEach(id=>$(id)?.addEventListener('click', startCheckout));
  ['#btn-portal','#btn-portal-2'].forEach(id=>$(id)?.addEventListener('click', openPortal));

  // ---------- Sample doc ----------
  $('#sampleDocLink')?.addEventListener('click', async (e)=>{
    e.preventDefault();
    try {
      const j = await fetchJSON(API('/api/documents/generate'), { method:'POST', body: JSON.stringify({}) });
      toast('Sample created: '+(j.title || j.id || 'OK'));
    } catch(e){ toast('Sample error: '+e.message); }
  });

  // ---------- Ask-Lex Chat + Voice ----------
  const dlg = $('#chatDlg'), openBtn = $('#openChat'), closeBtn = $('#closeChat');
  const msgs = $('#msgs'), input = $('#chatInput'), sendBtn = $('#sendBtn'), micBtn = $('#micBtn');
  openBtn?.addEventListener('click', ()=>dlg.showModal());
  closeBtn?.addEventListener('click', ()=>dlg.close());
  function push(role, text){
    const div = document.createElement('div');
    div.className='msg '+(role==='user'?'me':'bot');
    div.textContent=text; msgs.appendChild(div); msgs.scrollTop = msgs.scrollHeight;
  }
  async function send(){
    const text = input.value.trim(); if(!text) return;
    input.value=''; push('user', text);
    try{
      const j = await fetchJSON(API('/api/assistant/chat'), { method:'POST', body: JSON.stringify({ message:text }) });
      push('assistant', j.reply || '(no reply)');
    }catch(e){ push('assistant','Error: '+e.message); }
  }
  sendBtn?.addEventListener('click', send);
  input?.addEventListener('keydown', (e)=>{ if(e.key==='Enter' && !e.shiftKey){ e.preventDefault(); send(); }});

  // Voice (Web Speech API)
  let rec, listening=false;
  function ensureRec(){
    const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
    if(!SR){ toast('Voice not supported on this browser'); return null; }
    if(!rec){ rec = new SR(); rec.lang='en-US'; rec.interimResults=false; rec.maxAlternatives=1;
      rec.onresult = (e)=>{ const t=e.results[0][0].transcript; input.value=t; send(); };
      rec.onerror = ()=>{ listening=false; micBtn.textContent='üéôÔ∏è'; };
      rec.onend = ()=>{ listening=false; micBtn.textContent='üéôÔ∏è'; };
    }
    return rec;
  }
  micBtn?.addEventListener('click', ()=>{
    const r = ensureRec(); if(!r) return;
    if(!listening){ listening=true; micBtn.textContent='‚èπÔ∏è'; r.start(); } else { r.stop(); }
  });

  // ---------- Daily Bible verse (local rotation; can swap to API) ----------
  const verses = [
    `"Jesus said to him, 'I am the way, the truth, and the life. No one comes to the Father except through Me.'" ‚Äî John 14:6`,
    `"Trust in the LORD with all your heart and lean not on your own understanding." ‚Äî Proverbs 3:5`,
    `"The LORD is my shepherd; I shall not want." ‚Äî Psalm 23:1`,
    `"Blessed are the peacemakers, for they shall be called sons of God." ‚Äî Matthew 5:9`,
    `"Be strong and courageous... for the LORD your God is with you wherever you go." ‚Äî Joshua 1:9`,
    `"If God is for us, who can be against us?" ‚Äî Romans 8:31`,
    `"Let justice roll down like waters, and righteousness like an ever-flowing stream." ‚Äî Amos 5:24`,
    `"Whatever you do, work heartily, as for the Lord and not for men." ‚Äî Colossians 3:23`,
    `"The steadfast love of the LORD never ceases; his mercies never come to an end." ‚Äî Lamentations 3:22-23`,
    `"Ask, and it will be given to you; seek, and you will find." ‚Äî Matthew 7:7`
  ];
  const idx = new Date().getDate() % verses.length;
  $('#dailyVerse').textContent = verses[idx];
})();
</script>
</body>
</html>
