<!doctype html>
<html lang="en" class="no-js">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>LexOmega | Unified Legal Intelligence</title>
  <meta name="description" content="LexOmega ‚Äî AI-powered legal intelligence. Ask Lex, draft documents, track cases, and search law across jurisdictions." />
  <meta name="theme-color" content="#0b0f14" />
  <link rel="icon" href="/favicon.ico" />
  <meta name="color-scheme" content="dark light" />

  <style>
    :root{
      --bg:#0b0f14; --bg2:#0e1420; --surface:#0f1620; --line:#1e2a38;
      --text:#e9f0f6; --muted:#8aa0b2;
      --accent:#ffd54a; --accentText:#161a20;
      --teal:#12a3a0; --teal-700:#0d7c7a;
      --shadow:0 10px 30px rgba(0,0,0,.28);
      --radius:16px; --focus:#2fd2ff;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0}
    html{scroll-behavior:smooth}
    body{
      min-height:100vh;background:linear-gradient(180deg,var(--bg) 0%,var(--bg2) 100%);
      color:var(--text);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,"Noto Sans",sans-serif;
      -webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;
    }
    a{color:#cfe6ff;text-decoration:none}
    a:hover{filter:brightness(1.05)}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);border:0}
    :focus-visible{outline:3px solid var(--focus);outline-offset:2px;border-radius:8px}

    /* Promo bar */
    .promo{position:sticky;top:0;z-index:120;background:var(--teal);color:#041014;border-bottom:3px solid var(--accent)}
    .promo__inner{max-width:1200px;margin:0 auto;padding:10px 16px;font-weight:800;display:flex;gap:10px;align-items:center}

    /* Brand */
    .brandbar{background:rgba(0,0,0,.55);border-bottom:1px solid var(--line)}
    .brand{max-width:1200px;margin:0 auto;padding:12px 16px;display:flex;align-items:center;justify-content:space-between}
    .brand__left{display:flex;gap:10px;align-items:center}
    .brand__logo{width:36px;height:36px;border-radius:50%;background:var(--accent);color:#111;display:grid;place-items:center;font-weight:900}
    .brand__menu{width:44px;height:44px;border-radius:12px;border:1px solid var(--line);background:rgba(255,255,255,.06);display:grid;place-items:center;cursor:pointer;box-shadow:inset 0 0 0 1px rgba(255,255,255,.03)}
    .brand__menu span{width:18px;height:2px;background:var(--text);display:block;position:relative;border-radius:2px}
    .brand__menu span::before,.brand__menu span::after{content:"";position:absolute;left:0;width:18px;height:2px;background:var(--text);border-radius:2px}
    .brand__menu span::before{top:-6px}.brand__menu span::after{top:6px}

    /* Drawer */
    .drawer{position:fixed;inset:0 0 0 40%;max-width:420px;left:auto;background:#0b0f14f5;backdrop-filter:blur(10px);border-left:1px solid var(--line);transform:translateX(100%);transition:transform .18s ease;z-index:140}
    .drawer--open{transform:translateX(0)}
    .drawer__panel{padding:18px 16px}
    .drawer__link{display:block;padding:14px 8px;border-bottom:1px solid #132031;color:var(--text);font-weight:700;border-radius:10px}
    .drawer__link:hover{background:rgba(255,255,255,.04)}
    .drawer__row{display:flex;align-items:center;justify-content:space-between;padding:14px 8px}
    .select{background:#0f1620;color:var(--text);border:1px solid var(--line);border-radius:10px;padding:8px 10px;min-width:170px}
    .drawer__close{position:absolute;top:12px;right:12px}

    /* Layout & cards */
    .wrap{max-width:1200px;margin:20px auto;padding:0 16px}
    .h1{font-size:34px;margin:18px 0 6px;color:#2fd2ff}
    .sub{color:#9db2c4;margin:0 0 12px}
    .card{background:rgba(255,255,255,.04);border:1px solid var(--line);border-radius:var(--radius);padding:24px;box-shadow:var(--shadow)}
    .card--emph{border:1px solid #222f44}
    .card__title{font-size:22px;font-weight:900;margin:0 0 10px}
    .muted{color:var(--muted);font-size:12px}

    .row{display:flex;gap:10px;flex-wrap:wrap}
    .btn{background:var(--accent);color:var(--accentText);border:0;border-radius:12px;padding:12px 16px;font-weight:900;cursor:pointer;transition:transform .08s ease, filter .12s ease}
    .btn:hover{transform:translateY(-1px);filter:brightness(1.02)}
    .btn--ghost{background:transparent;color:var(--text);border:1px solid var(--line)}

    input[type="text"],input[type="search"]{background:#0e1622;color:var(--text);border:1px solid var(--line);padding:12px;border-radius:12px}
    .case{display:flex;gap:8px}
    .case button{padding:12px 16px;border-radius:12px;border:1px solid var(--line);background:var(--accent);color:var(--accentText);font-weight:900;cursor:pointer}

    /* Toast */
    .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:84px;background:#122032;color:var(--text);padding:10px 14px;border:1px solid #233449;border-radius:999px;font-size:12px;box-shadow:0 8px 20px rgba(0,0,0,.35);display:none;z-index:135}
    .toast--show{display:block}

    /* Chat */
    .fab{position:fixed;right:20px;bottom:20px;z-index:130;background:var(--accent);border:none;border-radius:999px;padding:14px 16px;font-weight:900;box-shadow:0 10px 24px rgba(0,0,0,.35);cursor:pointer}
    .fab:hover{transform:translateY(-1px)}
    .sheet{position:fixed;right:20px;bottom:90px;width:380px;max-width:92vw;max-height:70vh;display:none;flex-direction:column;background:var(--surface);border:1px solid #3a464f;border-radius:16px;overflow:hidden;z-index:131;box-shadow:0 16px 40px rgba(0,0,0,.45)}
    .sheet__head{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:2px solid var(--accent)}
    .sheet__body{padding:14px 12px;overflow:auto;display:flex;flex-direction:column;gap:10px}
    .msg{padding:10px 12px;border-radius:12px;line-height:1.4}
    .msg--me{background:#16324a;align-self:flex-end}
    .msg--bot{background:#122032;border:1px solid #233449}
    .sheet__foot{display:flex;gap:8px;padding:10px;border-top:1px solid var(--line)}
    .send{padding:10px 14px;border-radius:12px;border:1px solid var(--line);background:#1a2432;color:var(--text);cursor:pointer}

    /* Footer */
    .footer{border-top:1px solid var(--line);color:#9db2c4;padding:20px 16px 100px;text-align:center}

    @media (max-width:980px){ .wrap{margin:16px auto} }
    html[dir="rtl"] .brand{direction:rtl}
    html[dir="rtl"] .fab{left:20px;right:auto}
    html[dir="rtl"] .sheet{left:20px;right:auto}
  </style>
</head>
<body>
  <a href="#main" class="sr-only">Skip to content</a>

  <!-- Promo -->
  <div class="promo" role="region" aria-label="Promotion">
    <div class="promo__inner">
      <span aria-hidden="true">üì£</span>
      <span data-i18n="promo.text">LexOmega Launch Offer: 30-day free trial. No credit card required.</span>
    </div>
  </div>

  <!-- Brand -->
  <header class="brandbar">
    <div class="brand">
      <div class="brand__left">
        <div class="brand__logo" aria-label="LexOmega">L</div>
        <strong>LexOmega</strong>
      </div>
      <button class="brand__menu" id="menuBtn" aria-controls="drawer" aria-expanded="false" aria-label="Open menu">
        <span></span>
      </button>
    </div>
  </header>

  <!-- Drawer -->
  <aside class="drawer" id="drawer" aria-label="Main menu" aria-hidden="true" role="dialog">
    <button class="btn btn--ghost drawer__close" id="drawerClose" aria-label="Close menu">‚úï</button>
    <nav class="drawer__panel">
      <a class="drawer__link" href="/" data-i18n="ui.home">Home</a>
      <a class="drawer__link" href="/new-dashboard.html" data-i18n="ui.dashboard">Dashboard</a>
      <a class="drawer__link" href="/legal-tools.html" data-i18n="ui.tools">Tools</a>
      <a class="drawer__link" href="/documents.html" data-i18n="ui.documents">Documents</a>
      <a class="drawer__link" href="/notary.html" data-i18n="ui.notary">Notary</a>
      <div class="drawer__row">
        <label for="lang" data-i18n="ui.language">Language</label>
        <select id="lang" class="select" aria-label="Language">
          <option value="en" selected>English</option>
          <option value="es">Espa√±ol</option>
          <option value="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
          <option value="zh-CN">‰∏≠ÊñáÔºàÁÆÄ‰ΩìÔºâ</option>
          <option value="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
          <option value="fr">Fran√ßais</option>
          <option value="pt">Portugu√™s</option>
          <option value="de">Deutsch</option>
          <option value="ja">Êó•Êú¨Ë™û</option>
          <option value="ru">–†—É—Å—Å–∫–∏–π</option>
          <option value="ur">ÿßŸèÿ±ÿØŸèŸà</option>
          <option value="id">Bahasa Indonesia</option>
          <option value="bn">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ</option>
          <option value="sw">Kiswahili</option>
        </select>
      </div>
    </nav>
  </aside>

  <main id="main" class="wrap" tabindex="-1">
    <!-- Hero / Dashboard preview -->
    <section aria-labelledby="welcome">
      <h1 id="welcome" class="h1" data-i18n="hero.title">Welcome to LexOmega</h1>
      <p class="sub" data-i18n="hero.subtitle">The Future of Legal Intelligence</p>

      <article class="card card--emph" aria-labelledby="dashTitle">
        <h2 id="dashTitle" class="card__title" data-i18n="dash.title">Live Dashboard Preview</h2>
        <p class="muted" data-i18n="dash.copy">Analytics, case tracking, document generation and real-time alerts.</p>
        <div class="row" style="margin-top:10px">
          <a class="btn" href="/login.html" data-i18n="dash.login">Login</a>
          <a class="btn btn--ghost" href="/signup.html" data-i18n="dash.create">Create Account</a>
          <a class="btn btn--ghost" href="/logout" data-i18n="dash.logout">Logout</a>
        </div>
        <p class="muted" style="margin-top:12px">
          <strong data-i18n="dash.statusPrefix">Status:</strong>
          <span id="status" data-i18n="dash.statusGuest">Signed in as Guest</span>
        </p>
        <p id="statFail" class="muted" data-i18n="dash.unable">Unable to load stats.</p>
      </article>
    </section>

    <!-- Document preview -->
    <section aria-labelledby="docTitle" class="wrap__docs">
      <article class="card card--emph">
        <h2 id="docTitle" class="card__title" data-i18n="doc.title">Embedded Legal Document Preview</h2>
        <p><strong>LexOmega ‚Äî <span data-i18n="doc.sample">Document Sample</span></strong></p>
        <div class="card" style="background:#0c121b;border:1px dashed var(--line);text-align:center;color:#8aa0b2;">
          <div id="docBox" style="padding:30px 10px" data-i18n="doc.placeholder">Document preview placeholder</div>
        </div>
        <p id="docFail" class="muted" style="margin-top:10px" data-i18n="doc.unable">Unable to fetch documents.</p>
      </article>
    </section>

    <!-- Case search -->
    <section aria-labelledby="caseTitle">
      <article class="card card--emph">
        <h2 id="caseTitle" class="card__title" data-i18n="case.title">Case Search</h2>
        <p class="muted" data-i18n="case.hint">Try: ‚ÄúFourth Amendment traffic stop‚Äù</p>
        <div class="case" style="margin-top:8px">
          <input id="caseQ" type="search" placeholder="Search cases..." aria-label="Search cases" />
          <button id="caseGo" aria-label="Search">Search</button>
        </div>
      </article>
    </section>
  </main>

  <footer class="footer">
    ‚ÄúJesus said to him, 'I am the way, the truth, and the life. No one comes to the Father except through Me.' ‚Äî John 14:6
  </footer>

  <!-- Floating chat -->
  <button class="fab" id="chatOpen" aria-label="Open Ask Lex">üí¨</button>

  <!-- Ask Lex panel -->
  <section class="sheet" id="chat" aria-label="Ask Lex" role="dialog" aria-modal="false" aria-hidden="true">
    <header class="sheet__head">
      <strong data-i18n="chat.title">Ask Lex</strong>
      <button id="chatClose" class="btn btn--ghost" style="padding:6px 10px">Close</button>
    </header>
    <div class="sheet__body" id="chatBody">
      <div class="msg msg--bot">
        <div class="muted" data-i18n="chat.welcome">
          Ask anything like ‚ÄúGo to Tools‚Äù, ‚ÄúSearch: Miranda rights‚Äù, or ‚ÄúDraft an affidavit‚Äù.
        </div>
        <p><a href="#" id="voiceHint" class="muted" data-i18n="chat.voice">I can voice search as well</a></p>
      </div>
    </div>
    <footer class="sheet__foot">
      <input id="ask" type="text" placeholder="Type your question‚Ä¶" aria-label="Your question" />
      <button id="send" class="send" data-i18n="chat.send">Send</button>
    </footer>
    <p id="limit" class="muted" style="padding:0 10px 10px 10px"></p>
  </section>

  <div class="toast" id="toast">Continuing as guest</div>

  <script>
    /* ---------- Helpers ---------- */
    const $ = (s,r=document)=>r.querySelector(s);
    const $$ = (s,r=document)=>Array.from(r.querySelectorAll(s));
    const on = (el,ev,cb)=>el&&el.addEventListener(ev,cb);

    /* ---------- Drawer ---------- */
    const drawer=$("#drawer"), menuBtn=$("#menuBtn"), drawerClose=$("#drawerClose");
    let drawerLastFocus=null;
    function openDrawer(){drawerLastFocus=document.activeElement;drawer.classList.add("drawer--open");drawer.setAttribute("aria-hidden","false");menuBtn.setAttribute("aria-expanded","true");($("#drawer .drawer__panel a, #drawer select")||drawerClose).focus();}
    function closeDrawer(){drawer.classList.remove("drawer--open");drawer.setAttribute("aria-hidden","true");menuBtn.setAttribute("aria-expanded","false");drawerLastFocus&&drawerLastFocus.focus();}
    on(menuBtn,"click",openDrawer);on(drawerClose,"click",closeDrawer);on(drawer,"click",e=>{if(e.target===drawer)closeDrawer();});

    /* ---------- Toast ---------- */
    const toast=$("#toast");
    function showToast(msg,ms=2400){toast.textContent=msg;toast.classList.add("toast--show");setTimeout(()=>toast.classList.remove("toast--show"),ms);}
    showToast("Continuing as guest");

    /* ---------- i18n (flat dot-keys) ---------- */
    const LANG_KEY="lexomega.lang"; const RTL=new Set(["ar","ur"]);
    const I18N={
      en:{
        "promo.text":"LexOmega Launch Offer: 30-day free trial. No credit card required.",
        "ui.home":"Home","ui.dashboard":"Dashboard","ui.tools":"Tools","ui.documents":"Documents","ui.notary":"Notary","ui.language":"Language",
        "hero.title":"Welcome to LexOmega","hero.subtitle":"The Future of Legal Intelligence",
        "dash.title":"Live Dashboard Preview","dash.copy":"Analytics, case tracking, document generation and real-time alerts.","dash.login":"Login","dash.create":"Create Account","dash.logout":"Logout","dash.statusPrefix":"Status:","dash.statusGuest":"Signed in as Guest","dash.unable":"Unable to load stats.",
        "doc.title":"Embedded Legal Document Preview","doc.sample":"Document Sample","doc.placeholder":"Document preview placeholder","doc.unable":"Unable to fetch documents.",
        "case.title":"Case Search","case.hint":"Try: ‚ÄúFourth Amendment traffic stop‚Äù",
        "chat.title":"Ask Lex","chat.welcome":"Ask anything like ‚ÄúGo to Tools‚Äù, ‚ÄúSearch: Miranda rights‚Äù, or ‚ÄúDraft an affidavit‚Äù.","chat.voice":"I can voice search as well","chat.send":"Send","chat.limit":"LexOmega has reached today‚Äôs API capacity. Please retry later."
      },
      es:{
        "promo.text":"Oferta de lanzamiento: prueba gratis de 30 d√≠as. No se requiere tarjeta.",
        "ui.home":"Inicio","ui.dashboard":"Panel","ui.tools":"Herramientas","ui.documents":"Documentos","ui.notary":"Notar√≠a","ui.language":"Idioma",
        "hero.title":"Bienvenido a LexOmega","hero.subtitle":"El Futuro de la Inteligencia Legal",
        "dash.title":"Vista previa del panel en vivo","dash.copy":"Anal√≠tica, seguimiento de casos, generaci√≥n de documentos y alertas en tiempo real.","dash.login":"Acceder","dash.create":"Crear cuenta","dash.logout":"Salir","dash.statusPrefix":"Estado:","dash.statusGuest":"Conectado como invitado","dash.unable":"No se pueden cargar estad√≠sticas.",
        "doc.title":"Vista previa de documento legal incrustado","doc.sample":"Documento de ejemplo","doc.placeholder":"Marcador de vista previa de documento","doc.unable":"No se pueden obtener documentos.",
        "case.title":"B√∫squeda de casos","case.hint":"Prueba: ‚ÄúDetenci√≥n de tr√°fico Cuarta Enmienda‚Äù",
        "chat.title":"Preguntar a Lex","chat.welcome":"¬°Hola! Pregunta algo como ‚ÄúIr a Herramientas‚Äù, ‚ÄúBuscar: derechos Miranda‚Äù o ‚ÄúRedactar una declaraci√≥n jurada‚Äù.","chat.voice":"Tambi√©n puedo buscar por voz","chat.send":"Enviar","chat.limit":"Se alcanz√≥ la capacidad de la API. Int√©ntalo luego."
      },
      ar:{
        "promo.text":"ÿπÿ±ÿ∂ ÿßŸÑÿ•ÿ∑ŸÑÿßŸÇ: ÿ™ÿ¨ÿ±ÿ®ÿ© ŸÖÿ¨ÿßŸÜŸäÿ© ŸÑŸÖÿØÿ© 30 ŸäŸàŸÖÿßŸã. ŸÑÿß ÿ≠ÿßÿ¨ÿ© ŸÑÿ®ÿ∑ÿßŸÇÿ©.",
        "ui.home":"ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©","ui.dashboard":"ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ","ui.tools":"ÿßŸÑÿ£ÿØŸàÿßÿ™","ui.documents":"ÿßŸÑŸÖÿ≥ÿ™ŸÜÿØÿßÿ™","ui.notary":"ÿßŸÑÿ™Ÿàÿ´ŸäŸÇ","ui.language":"ÿßŸÑŸÑÿ∫ÿ©",
        "hero.title":"ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ŸÉ ŸÅŸä ŸÑŸäŸÉÿ≥ ÿ£ŸàŸÖŸäÿ∫ÿß","hero.subtitle":"ŸÖÿ≥ÿ™ŸÇÿ®ŸÑ ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑŸÇÿßŸÜŸàŸÜŸä",
        "dash.title":"ŸÖÿπÿßŸäŸÜÿ© ŸÑŸàÿ≠ÿ© ÿßŸÑŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿ≠Ÿäÿ©","dash.copy":"ÿ™ÿ≠ŸÑŸäŸÑÿßÿ™ÿå ÿ™ÿ™ÿ®ÿπ ÿßŸÑŸÇÿ∂ÿßŸäÿßÿå ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÖÿ≥ÿ™ŸÜÿØÿßÿ™ÿå Ÿàÿ™ŸÜÿ®ŸäŸáÿßÿ™ ŸÅŸàÿ±Ÿäÿ©.","dash.login":"ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ","dash.create":"ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ÿ≥ÿßÿ®","dash.logout":"ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨","dash.statusPrefix":"ÿßŸÑÿ≠ÿßŸÑÿ©:","dash.statusGuest":"ŸÖÿ™ÿµŸÑ ŸÉÿ∂ŸäŸÅ","dash.unable":"Ÿäÿ™ÿπÿ∞ÿ± ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ•ÿ≠ÿµÿßÿ°ÿßÿ™.",
        "doc.title":"ŸÖÿπÿßŸäŸÜÿ© ŸÖÿ≥ÿ™ŸÜÿØ ŸÇÿßŸÜŸàŸÜŸä ŸÖŸèÿ∂ŸÖŸëŸéŸÜ","doc.sample":"ŸÜŸÖŸàÿ∞ÿ¨ ŸÖÿ≥ÿ™ŸÜÿØ","doc.placeholder":"ÿπŸÜÿµÿ± ŸÜÿßÿ¶ÿ® ŸÑŸÖÿπÿßŸäŸÜÿ© ÿßŸÑŸÖÿ≥ÿ™ŸÜÿØ","doc.unable":"ÿ™ÿπÿ∞ÿ± ÿ¨ŸÑÿ® ÿßŸÑŸÖÿ≥ÿ™ŸÜÿØÿßÿ™.",
        "case.title":"ÿ®ÿ≠ÿ´ ÿßŸÑŸÇÿ∂ÿßŸäÿß","case.hint":"ÿ¨ÿ±Ÿëÿ®: ¬´ÿ™ŸàŸÇŸäŸÅ ŸÖÿ±Ÿàÿ±Ÿä ŸàÿßŸÑÿ™ÿπÿØŸäŸÑ ÿßŸÑÿ±ÿßÿ®ÿπ¬ª",
        "chat.title":"ÿßÿ≥ÿ£ŸÑ ŸÑŸäŸÉÿ≥","chat.welcome":"ÿßÿ≥ÿ£ŸÑ ÿ£Ÿä ÿ¥Ÿäÿ° ŸÖÿ´ŸÑ ¬´ÿßÿ∞Ÿáÿ® ÿ•ŸÑŸâ ÿßŸÑÿ£ÿØŸàÿßÿ™¬ªÿå ¬´ÿßÿ®ÿ≠ÿ´: ÿ≠ŸÇŸàŸÇ ŸÖŸäÿ±ÿßŸÜÿØÿß¬ªÿå ÿ£Ÿà ¬´ÿµŸêÿ∫ ÿ•ŸÅÿßÿØÿ©¬ª.","chat.voice":"ŸäŸÖŸÉŸÜŸÜŸä ÿßŸÑÿ®ÿ≠ÿ´ ÿµŸàÿ™ŸäÿßŸã ÿ£Ÿäÿ∂ÿßŸã","chat.send":"ÿ•ÿ±ÿ≥ÿßŸÑ","chat.limit":"ÿ™ŸÖ ÿ®ŸÑŸàÿ∫ ÿ≥ÿπÿ© Ÿàÿßÿ¨Ÿáÿ© ÿßŸÑÿ®ÿ±ŸÖÿ¨ÿ© ŸÑŸÑŸäŸàŸÖ. ÿ≠ÿßŸàŸÑ ŸÑÿßÿ≠ŸÇÿßŸã."
      }
    };
    function setLang(l){
      const d=I18N[l]||I18N.en;
      $$("[data-i18n]").forEach(el=>{ const k=el.dataset.i18n; el.innerHTML = d[k] ?? k; });
      document.documentElement.lang=l;
      document.documentElement.dir = RTL.has(l) ? "rtl" : "ltr";
      localStorage.setItem(LANG_KEY,l);
      const sel=$("#lang"); if(sel) sel.value=l;
    }
    setLang(localStorage.getItem(LANG_KEY)||"en");
    on($("#lang"),"change",e=>setLang(e.target.value));

    /* ---------- Status & doc previews (graceful fallback) ---------- */
    (async()=>{
      try{const r=await fetch("/api/status"); if(!r.ok) throw 0; const j=await r.json(); if(j?.user) $("#status").textContent=j.user; $("#statFail").style.display="none";}catch{}
      try{const r=await fetch("/api/documents/sample"); if(!r.ok) throw 0; const html=await r.text(); $("#docBox").innerHTML=html; $("#docFail").style.display="none";}catch{}
    })();

    /* ---------- Case Search (placeholder demo) ---------- */
    on($("#caseGo"),"click",()=>{
      const m=document.createElement("div");
      m.className="msg msg--bot";
      m.innerHTML='<span class="muted">Error: Failed to fetch</span>';
      $("#chatBody").appendChild(m);
      showToast("Searching cases‚Ä¶ (demo)");
    });

    /* ---------- Ask Lex (cache + throttle + 429) ---------- */
    const chat=$("#chat"), chatOpen=$("#chatOpen"), chatClose=$("#chatClose"), chatBody=$("#chatBody"), ask=$("#ask"), send=$("#send"), limit=$("#limit");
    function openChat(){chat.style.display="flex";ask.focus();chat.setAttribute("aria-hidden","false");}
    function closeChat(){chat.style.display="none";chat.setAttribute("aria-hidden","true");chatOpen.focus();}
    on(chatOpen,"click",openChat); on(chatClose,"click",closeChat);

    function bubble(html,me=false){const d=document.createElement("div"); d.className=`msg ${me?"msg--me":"msg--bot"}`; d.innerHTML=html; chatBody.appendChild(d); chatBody.scrollTop=chatBody.scrollHeight;}

    const CACHE_KEY="lexomega.cache.v1"; let CACHE={order:[],map:{}}; try{const c=JSON.parse(localStorage.getItem(CACHE_KEY)||""); if(c?.order && c?.map) CACHE=c;}catch{}
    const sleep=ms=>new Promise(r=>setTimeout(r,ms));
    function cacheGet(k){return CACHE.map[k];}
    function cachePut(k,v){const MAX=100; if(CACHE.map[k]!==undefined){CACHE.order=CACHE.order.filter(x=>x!==k);} CACHE.map[k]=v; CACHE.order.unshift(k); while(CACHE.order.length>MAX){const old=CACHE.order.pop(); delete CACHE.map[old];} localStorage.setItem(CACHE_KEY,JSON.stringify(CACHE));}

    let sending=false;
    async function fetchWithRetry(url,opts,retries=2){
      let a=0; while(true){
        try{const res=await fetch(url,opts);
          if(res.status===429){limit.textContent=I18N[document.documentElement.lang]["chat.limit"]; return {ok:false,code:429};}
          if(!res.ok) throw new Error(String(res.status));
          return {ok:true,json:await res.json()};
        }catch(e){if(a>=retries) return {ok:false,code:e.message||"ERR"}; await sleep(300*Math.pow(2,a++));}
      }
    }

    async function askLex(){
      const q=(ask.value||"").trim(); if(!q||sending) return;
      sending=true; send.disabled=true; limit.textContent=""; bubble(q,true); ask.value="";
      const lng=document.documentElement.lang||"en"; const key=`${lng}|${q}`; const c=cacheGet(key);
      if(c){bubble(c); sending=false; send.disabled=false; return;}
      await sleep(600);
      const res=await fetchWithRetry("/api/chat",{method:"POST",headers:{"Content-Type":"application/json","x-lex-locale":lng,"Accept-Language":lng},body:JSON.stringify({query:q,locale:lng})});
      if(!res.ok){ if(res.code===429){sending=false; send.disabled=false; return;} bubble(`<span class="muted">(Error ${res.code}) Something went wrong. Please try again.</span>`); sending=false; send.disabled=false; return;}
      const answer=res.json?.answer ?? res.json?.text ?? "‚Äî"; bubble(answer); cachePut(key,answer); sending=false; send.disabled=false;
    }
    on(send,"click",askLex); on(ask,"keydown",e=>{if(e.key==="Enter"&&!e.shiftKey){e.preventDefault();askLex();}});

    on(document,"keydown",e=>{if(e.key==="Escape"){ if($("#chat").style.display==="flex") closeChat(); if($("#drawer").classList.contains("drawer--open")) closeDrawer(); }});
  </script>
</body>
</html>
